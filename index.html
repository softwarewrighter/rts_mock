<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTS Game UI Mockup</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            overflow: hidden;
            height: 100vh;
        }

        .game-container {
            display: grid;
            grid-template-areas: 
                "resources resources resources"
                "map map minimap"
                "build research controls";
            grid-template-columns: 1fr 1fr 300px;
            grid-template-rows: 50px 1fr 200px;
            height: 100vh;
            gap: 2px;
            background: #333;
        }

        .resource-panel {
            grid-area: resources;
            background: #2a2a2a;
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 2px solid #444;
        }

        .resource-item {
            margin-right: 30px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 3px;
            transition: background 0.2s;
        }

        .resource-item:hover {
            background: #444;
        }

        .main-map {
            grid-area: map;
            background: #0a0a0a;
            position: relative;
            border: 2px solid #444;
            overflow: hidden;
            cursor: grab;
        }
        
        .main-map.dragging {
            cursor: grabbing;
        }

        .minimap {
            grid-area: minimap;
            background: #1a1a1a;
            border: 2px solid #444;
            position: relative;
        }

        .build-menu {
            grid-area: build;
            background: #2a2a2a;
            border: 2px solid #444;
            padding: 10px;
            overflow-y: auto;
        }

        .research-menu {
            grid-area: research;
            background: #2a2a2a;
            border: 2px solid #444;
            padding: 10px;
            overflow-y: auto;
        }

        .controls {
            grid-area: controls;
            background: #2a2a2a;
            border: 2px solid #444;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .menu-title {
            color: #00ccff;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-size: 14px;
        }

        .menu-button, .control-button {
            background: #1a1a1a;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 8px 16px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            text-transform: uppercase;
            transition: all 0.2s;
            margin-bottom: 5px;
            display: block;
            width: 100%;
        }

        .menu-button:hover, .control-button:hover {
            background: #00ff00;
            color: #1a1a1a;
            box-shadow: 0 0 10px #00ff00;
        }

        .control-button {
            background: #2a2a2a;
            border: 2px solid #00ccff;
            color: #00ccff;
        }

        .control-button:hover {
            background: #00ccff;
            color: #1a1a1a;
            box-shadow: 0 0 10px #00ccff;
        }

        .status-display {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #0a0a0a;
            color: #00ff00;
            padding: 10px 20px;
            border-top: 2px solid #444;
            font-size: 14px;
            z-index: 1000;
        }

        /* SVG Styles */
        .map-svg, .minimap-svg {
            width: 100%;
            height: 100%;
        }

        .terrain {
            fill: #2a4a2a;
            stroke: #1a3a1a;
            stroke-width: 1;
        }

        .water {
            fill: #003366;
            stroke: #002244;
            stroke-width: 1;
        }

        .mountain {
            fill: #4a4a4a;
            stroke: #333;
            stroke-width: 1;
        }

        .building {
            fill: #8a6a3a;
            stroke: #6a4a2a;
            stroke-width: 2;
        }

        .unit {
            fill: #ffff00;
            stroke: #cccc00;
            stroke-width: 1;
        }

        .resource-node {
            fill: #0066ff;
            stroke: #0044cc;
            stroke-width: 1;
        }
        
        #viewport-rect {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="resource-panel">
            <div class="resource-item" onclick="handleResourceClick('gold')">
                ðŸ’° Gold: 1500
            </div>
            <div class="resource-item" onclick="handleResourceClick('wood')">
                ðŸŒ² Wood: 800
            </div>
            <div class="resource-item" onclick="handleResourceClick('stone')">
                ðŸ—¿ Stone: 600
            </div>
            <div class="resource-item" onclick="handleResourceClick('food')">
                ðŸŒ¾ Food: 400
            </div>
            <div class="resource-item" onclick="handleResourceClick('population')">
                ðŸ‘¥ Population: 45/100
            </div>
        </div>

        <div class="main-map" id="main-map">
            <svg class="map-svg" id="map-svg" viewBox="0 0 800 600">
                <g id="map-content">
                    <!-- Terrain (now covers the full map size) -->
                    <rect class="terrain" x="0" y="0" width="2400" height="1800"/>
                    
                    <!-- Water bodies (distributed across the larger map) -->
                    <ellipse class="water" cx="200" cy="150" rx="80" ry="40"/>
                    <ellipse class="water" cx="600" cy="400" rx="100" ry="60"/>
                    <ellipse class="water" cx="1400" cy="800" rx="120" ry="70"/>
                    <ellipse class="water" cx="2000" cy="300" rx="90" ry="50"/>
                    <ellipse class="water" cx="1800" cy="1400" rx="150" ry="80"/>
                    
                    <!-- Mountains (distributed across the larger map) -->
                    <polygon class="mountain" points="100,100 150,50 200,100 175,150 125,150"/>
                    <polygon class="mountain" points="650,200 700,150 750,200 725,250 675,250"/>
                    <polygon class="mountain" points="50,450 100,400 150,450 125,500 75,500"/>
                    <polygon class="mountain" points="1200,600 1250,550 1300,600 1275,650 1225,650"/>
                    <polygon class="mountain" points="1600,1000 1650,950 1700,1000 1675,1050 1625,1050"/>
                    <polygon class="mountain" points="2200,1500 2250,1450 2300,1500 2275,1550 2225,1550"/>
                    <polygon class="mountain" points="900,1300 950,1250 1000,1300 975,1350 925,1350"/>
                    
                    <!-- Resource nodes (distributed across the larger map) -->
                    <circle class="resource-node" cx="300" cy="200" r="8"/>
                    <circle class="resource-node" cx="500" cy="300" r="8"/>
                    <circle class="resource-node" cx="400" cy="500" r="8"/>
                    <circle class="resource-node" cx="1100" cy="400" r="8"/>
                    <circle class="resource-node" cx="1500" cy="700" r="8"/>
                    <circle class="resource-node" cx="1800" cy="1100" r="8"/>
                    <circle class="resource-node" cx="2100" cy="900" r="8"/>
                    <circle class="resource-node" cx="700" cy="1200" r="8"/>
                    <circle class="resource-node" cx="1300" cy="1500" r="8"/>
                    
                    <!-- Buildings (distributed across the larger map) -->
                    <rect class="building" x="1150" y="1050" width="30" height="30"/>
                    <rect class="building" x="1200" y="1000" width="25" height="25"/>
                    <rect class="building" x="1600" y="600" width="35" height="35"/>
                    <rect class="building" x="2000" y="1200" width="30" height="30"/>
                    <rect class="building" x="800" y="800" width="40" height="40"/>
                    
                    <!-- Units (distributed across the larger map) -->
                    <circle class="unit" cx="1120" cy="1080" r="5"/>
                    <circle class="unit" cx="1180" cy="1120" r="5"/>
                    <circle class="unit" cx="1250" cy="1050" r="5"/>
                    <circle class="unit" cx="1220" cy="1080" r="5"/>
                    <circle class="unit" cx="820" cy="850" r="5"/>
                    <circle class="unit" cx="850" cy="820" r="5"/>
                    <circle class="unit" cx="1650" cy="650" r="5"/>
                    <circle class="unit" cx="2050" cy="1250" r="5"/>
                </g>
            </svg>
        </div>

        <div class="minimap">
            <div class="menu-title">MINIMAP</div>
            <svg class="minimap-svg" viewBox="0 0 200 150">
                <!-- Simplified terrain -->
                <rect class="terrain" x="0" y="0" width="200" height="150"/>
                
                <!-- Water (scaled down from main map) -->
                <ellipse class="water" cx="17" cy="12" rx="7" ry="3"/>
                <ellipse class="water" cx="50" cy="33" rx="8" ry="5"/>
                <ellipse class="water" cx="117" cy="67" rx="10" ry="6"/>
                <ellipse class="water" cx="167" cy="25" rx="7" ry="4"/>
                <ellipse class="water" cx="150" cy="117" rx="12" ry="7"/>
                
                <!-- Mountains (scaled down from main map) -->
                <polygon class="mountain" points="8,8 12,4 17,8 15,12 10,12"/>
                <polygon class="mountain" points="54,17 58,12 62,17 60,21 56,21"/>
                <polygon class="mountain" points="4,37 8,33 12,37 10,42 6,42"/>
                <polygon class="mountain" points="100,50 104,46 108,50 106,54 102,54"/>
                <polygon class="mountain" points="133,83 137,79 142,83 140,87 135,87"/>
                <polygon class="mountain" points="183,125 187,121 192,125 190,129 185,129"/>
                <polygon class="mountain" points="75,108 79,104 83,108 81,112 77,112"/>
                
                <!-- Buildings (scaled down from main map) -->
                <rect class="building" x="96" y="87" width="3" height="3"/>
                <rect class="building" x="100" y="83" width="2" height="2"/>
                <rect class="building" x="133" y="50" width="3" height="3"/>
                <rect class="building" x="167" y="100" width="3" height="3"/>
                <rect class="building" x="67" y="67" width="3" height="3"/>
                
                <!-- Units (scaled down from main map) -->
                <circle class="unit" cx="93" cy="90" r="1"/>
                <circle class="unit" cx="98" cy="93" r="1"/>
                <circle class="unit" cx="104" cy="87" r="1"/>
                <circle class="unit" cx="102" cy="90" r="1"/>
                <circle class="unit" cx="68" cy="71" r="1"/>
                <circle class="unit" cx="71" cy="68" r="1"/>
                <circle class="unit" cx="137" cy="54" r="1"/>
                <circle class="unit" cx="171" cy="104" r="1"/>
                
                <!-- View rectangle -->
                <rect id="viewport-rect" x="66" y="50" width="67" height="50" fill="none" stroke="#ffff00" stroke-width="2" opacity="0.8"/>
            </svg>
        </div>

        <div class="build-menu">
            <div class="menu-title">BUILD MENU</div>
            <button class="menu-button" onclick="handleBuildButton('barracks')">Barracks</button>
            <button class="menu-button" onclick="handleBuildButton('house')">House</button>
            <button class="menu-button" onclick="handleBuildButton('farm')">Farm</button>
            <button class="menu-button" onclick="handleBuildButton('mine')">Mine</button>
            <button class="menu-button" onclick="handleBuildButton('tower')">Tower</button>
            <button class="menu-button" onclick="handleBuildButton('wall')">Wall</button>
            <button class="menu-button" onclick="handleBuildButton('gate')">Gate</button>
            <button class="menu-button" onclick="handleBuildButton('workshop')">Workshop</button>
        </div>

        <div class="research-menu">
            <div class="menu-title">RESEARCH</div>
            <button class="menu-button" onclick="handleResearchButton('armor')">Armor Tech</button>
            <button class="menu-button" onclick="handleResearchButton('weapons')">Weapon Tech</button>
            <button class="menu-button" onclick="handleResearchButton('agriculture')">Agriculture</button>
            <button class="menu-button" onclick="handleResearchButton('mining')">Mining Tech</button>
            <button class="menu-button" onclick="handleResearchButton('construction')">Construction</button>
            <button class="menu-button" onclick="handleResearchButton('magic')">Magic Arts</button>
            <button class="menu-button" onclick="handleResearchButton('tactics')">Tactics</button>
        </div>

        <div class="controls">
            <div class="menu-title">UNIT CONTROLS</div>
            <button class="control-button" onclick="handleUnitCommand('move')">MOVE</button>
            <button class="control-button" onclick="handleUnitCommand('attack')">ATTACK</button>
            <button class="control-button" onclick="handleUnitCommand('patrol')">PATROL</button>
            <button class="control-button" onclick="handleUnitCommand('stop')">STOP</button>
        </div>
    </div>

    <div class="status-display" id="status">
        RTS Game UI Mockup - Click on any element to see status messages
    </div>

    <script type="module">
        import init, { 
            handle_map_click, 
            handle_minimap_click, 
            handle_build_button, 
            handle_research_button, 
            handle_unit_command,
            handle_resource_click,
            log_status 
        } from './pkg/rts_mock.js';

        // Map state management in JavaScript
        const mapState = {
            mapWidth: 2400,
            mapHeight: 1800,
            viewportWidth: 800,
            viewportHeight: 600,
            viewportX: 800, // Start centered
            viewportY: 600
        };

        let isDragging = false;
        let dragStart = { x: 0, y: 0 };
        let viewportStart = { x: 0, y: 0 };
        let scrollInterval = null;
        let currentMousePos = { x: 0, y: 0 };

        function updateMapView() {
            const mapContent = document.getElementById('map-content');
            if (mapContent) {
                mapContent.setAttribute('transform', `translate(${-mapState.viewportX}, ${-mapState.viewportY})`);
            }
            updateMinimapViewport();
        }

        function updateMinimapViewport() {
            const viewportRect = document.getElementById('viewport-rect');
            if (viewportRect) {
                const scaleX = 200 / mapState.mapWidth;
                const scaleY = 150 / mapState.mapHeight;
                
                viewportRect.setAttribute('x', mapState.viewportX * scaleX);
                viewportRect.setAttribute('y', mapState.viewportY * scaleY);
                viewportRect.setAttribute('width', mapState.viewportWidth * scaleX);
                viewportRect.setAttribute('height', mapState.viewportHeight * scaleY);
            }
        }

        function clampViewport() {
            mapState.viewportX = Math.max(0, Math.min(mapState.viewportX, mapState.mapWidth - mapState.viewportWidth));
            mapState.viewportY = Math.max(0, Math.min(mapState.viewportY, mapState.mapHeight - mapState.viewportHeight));
        }

        function handleEdgeScroll() {
            const mapDiv = document.getElementById('main-map');
            const rect = mapDiv.getBoundingClientRect();
            const edgeThreshold = 50;
            const scrollSpeed = 15;
            
            let dx = 0;
            let dy = 0;
            
            if (currentMousePos.x < edgeThreshold) dx = -scrollSpeed;
            else if (currentMousePos.x > rect.width - edgeThreshold) dx = scrollSpeed;
            
            if (currentMousePos.y < edgeThreshold) dy = -scrollSpeed;
            else if (currentMousePos.y > rect.height - edgeThreshold) dy = scrollSpeed;
            
            if (dx !== 0 || dy !== 0) {
                mapState.viewportX += dx;
                mapState.viewportY += dy;
                clampViewport();
                updateMapView();
            }
        }

        async function run() {
            await init();
            
            // Override console.log to show status in UI
            const originalLog = console.log;
            console.log = function(message) {
                originalLog(message);
                const statusEl = document.getElementById('status');
                if (statusEl && typeof message === 'string' && message.includes('RTS Status:')) {
                    statusEl.textContent = message.replace('RTS Status: ', '');
                }
            };

            // Initialize map view
            updateMapView();
            log_status("Game UI initialized with scrollable map");

            // Map interactions
            const mapSvg = document.getElementById('map-svg');
            const mapDiv = document.getElementById('main-map');
            
            // Map click handler
            mapSvg.addEventListener('click', function(event) {
                if (!isDragging) {
                    const pt = mapSvg.createSVGPoint();
                    pt.x = event.clientX;
                    pt.y = event.clientY;
                    const svgP = pt.matrixTransform(mapSvg.getScreenCTM().inverse());
                    const worldX = svgP.x + mapState.viewportX;
                    const worldY = svgP.y + mapState.viewportY;
                    handle_map_click(worldX, worldY);
                }
            });

            // Mouse down for drag
            mapDiv.addEventListener('mousedown', function(event) {
                if (event.button === 0) { // Left mouse button
                    isDragging = true;
                    dragStart.x = event.clientX;
                    dragStart.y = event.clientY;
                    viewportStart.x = mapState.viewportX;
                    viewportStart.y = mapState.viewportY;
                    mapDiv.classList.add('dragging');
                    event.preventDefault();
                }
            });

            // Mouse move for drag and edge scroll
            document.addEventListener('mousemove', function(event) {
                const rect = mapDiv.getBoundingClientRect();
                const isOverMap = event.clientX >= rect.left && event.clientX <= rect.right &&
                                 event.clientY >= rect.top && event.clientY <= rect.bottom;
                
                if (isOverMap) {
                    currentMousePos.x = event.clientX - rect.left;
                    currentMousePos.y = event.clientY - rect.top;
                    
                    if (isDragging && event.buttons === 1) {
                        const dx = dragStart.x - event.clientX;
                        const dy = dragStart.y - event.clientY;
                        mapState.viewportX = viewportStart.x + dx;
                        mapState.viewportY = viewportStart.y + dy;
                        clampViewport();
                        updateMapView();
                    } else if (!isDragging && !scrollInterval) {
                        scrollInterval = setInterval(handleEdgeScroll, 16);
                    }
                } else if (scrollInterval) {
                    clearInterval(scrollInterval);
                    scrollInterval = null;
                }
            });

            // Mouse up to stop drag
            document.addEventListener('mouseup', function(event) {
                if (event.button === 0) {
                    isDragging = false;
                    mapDiv.classList.remove('dragging');
                }
            });

            // Minimap click handler
            const minimapSvg = document.querySelector('.minimap-svg');
            minimapSvg.addEventListener('click', function(event) {
                const pt = minimapSvg.createSVGPoint();
                pt.x = event.clientX;
                pt.y = event.clientY;
                const svgP = pt.matrixTransform(minimapSvg.getScreenCTM().inverse());
                
                // Convert minimap coordinates to world coordinates
                const scaleX = mapState.mapWidth / 200;
                const scaleY = mapState.mapHeight / 150;
                
                // Center viewport on clicked position
                mapState.viewportX = (svgP.x * scaleX) - (mapState.viewportWidth / 2);
                mapState.viewportY = (svgP.y * scaleY) - (mapState.viewportHeight / 2);
                clampViewport();
                updateMapView();
                
                handle_minimap_click(svgP.x, svgP.y);
            });

            // Keyboard controls
            document.addEventListener('keydown', function(event) {
                const step = 30;
                let moved = false;
                
                switch(event.key) {
                    case 'ArrowUp':
                    case 'w':
                    case 'W':
                        mapState.viewportY -= step;
                        moved = true;
                        break;
                    case 'ArrowDown':
                    case 's':
                    case 'S':
                        mapState.viewportY += step;
                        moved = true;
                        break;
                    case 'ArrowLeft':
                    case 'a':
                    case 'A':
                        mapState.viewportX -= step;
                        moved = true;
                        break;
                    case 'ArrowRight':
                    case 'd':
                    case 'D':
                        mapState.viewportX += step;
                        moved = true;
                        break;
                }
                
                if (moved) {
                    event.preventDefault();
                    clampViewport();
                    updateMapView();
                    log_status(`Viewport moved to (${Math.round(mapState.viewportX)}, ${Math.round(mapState.viewportY)})`);
                }
            });

            // Make WASM functions globally available
            window.handleBuildButton = handle_build_button;
            window.handleResearchButton = handle_research_button;
            window.handleUnitCommand = handle_unit_command;
            window.handleResourceClick = handle_resource_click;
        }

        run();
    </script>
</body>
</html>