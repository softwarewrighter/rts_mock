<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTS Game UI Mockup</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            overflow: hidden;
            height: 100vh;
        }

        .game-container {
            display: grid;
            grid-template-areas:
                "resources resources resources"
                "map map minimap"
                "build research controls";
            grid-template-columns: 1fr 1fr 300px;
            grid-template-rows: 50px 1fr 200px;
            height: calc(100vh - 60px);
            gap: 2px;
            background: #333;
        }

        .resource-panel {
            grid-area: resources;
            background: #2a2a2a;
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 2px solid #444;
        }

        .resource-item {
            margin-right: 30px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 3px;
            transition: background 0.2s;
        }

        .resource-item:hover {
            background: #444;
        }

        .main-map {
            grid-area: map;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
            position: relative;
            border: 2px solid #444;
            overflow: hidden;
            cursor: grab;
        }
        
        .main-map.dragging {
            cursor: grabbing;
        }

        .minimap {
            grid-area: minimap;
            background: #1a1a1a;
            border: 2px solid #444;
            position: relative;
        }

        .build-menu {
            grid-area: build;
            background: #2a2a2a;
            border: 2px solid #444;
            padding: 10px;
            overflow-y: auto;
        }

        .research-menu {
            grid-area: research;
            background: #2a2a2a;
            border: 2px solid #444;
            padding: 10px;
            overflow-y: auto;
        }

        .controls {
            grid-area: controls;
            background: #2a2a2a;
            border: 2px solid #444;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .menu-title {
            color: #00ccff;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-size: 14px;
        }

        .menu-button, .control-button {
            background: #1a1a1a;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 8px 16px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            text-transform: uppercase;
            transition: all 0.2s;
            margin-bottom: 5px;
            display: block;
            width: 100%;
        }

        .menu-button:hover, .control-button:hover {
            background: #00ff00;
            color: #1a1a1a;
            box-shadow: 0 0 10px #00ff00;
        }

        .control-button {
            background: #2a2a2a;
            border: 2px solid #00ccff;
            color: #00ccff;
        }

        .control-button:hover {
            background: #00ccff;
            color: #1a1a1a;
            box-shadow: 0 0 10px #00ccff;
        }

        .status-display {
            position: fixed;
            bottom: 30px;
            left: 0;
            right: 0;
            background: #0a0a0a;
            color: #00ff00;
            padding: 10px 20px;
            border-top: 2px solid #444;
            font-size: 14px;
            z-index: 1000;
        }

        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1a1a1a;
            color: #00cc00;
            padding: 6px 20px;
            border-top: 1px solid #444;
            font-size: 11px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            z-index: 999;
            height: 30px;
        }

        .footer a {
            color: #00ff00;
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer a:hover {
            color: #00ffff;
            text-decoration: underline;
        }

        .footer-separator {
            color: #444;
        }

        /* SVG Styles */
        .map-svg, .minimap-svg {
            width: 100%;
            height: 100%;
        }

        /* Main map isometric styles */
        .map-svg .terrain {
            fill: url(#terrainGradient);
            stroke: #1a3a1a;
            stroke-width: 0.5;
        }

        .map-svg .water {
            fill: url(#waterGradient);
            stroke: #002244;
            stroke-width: 0.5;
        }

        .map-svg .mountain {
            fill: url(#mountainGradient);
            stroke: #333;
            stroke-width: 0.5;
        }

        .map-svg .building {
            fill: url(#buildingGradient);
            stroke: #6a4a2a;
            stroke-width: 1;
        }

        .map-svg .unit {
            fill: url(#unitGradient);
            stroke: #cccc00;
            stroke-width: 1;
        }

        .map-svg .resource-node {
            fill: url(#resourceGradient);
            stroke: #0044cc;
            stroke-width: 1;
        }

        /* Minimap 2D styles (simpler, top-down) */
        .minimap-svg .terrain {
            fill: #2a4a2a;
            stroke: #1a3a1a;
            stroke-width: 1;
        }

        .minimap-svg .water {
            fill: #003366;
            stroke: #002244;
            stroke-width: 1;
        }

        .minimap-svg .mountain {
            fill: #4a4a4a;
            stroke: #333;
            stroke-width: 1;
        }

        .minimap-svg .building {
            fill: #8a6a3a;
            stroke: #6a4a2a;
            stroke-width: 1;
        }

        .minimap-svg .unit {
            fill: #ffff00;
            stroke: #cccc00;
            stroke-width: 1;
        }

        .minimap-svg .resource-node {
            fill: #0066ff;
            stroke: #0044cc;
            stroke-width: 1;
        }
        
        #viewport-rect {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="resource-panel">
            <div class="resource-item" onclick="handleResourceClick('gold')">
                ðŸ’° Gold: 1500
            </div>
            <div class="resource-item" onclick="handleResourceClick('wood')">
                ðŸŒ² Wood: 800
            </div>
            <div class="resource-item" onclick="handleResourceClick('stone')">
                ðŸ—¿ Stone: 600
            </div>
            <div class="resource-item" onclick="handleResourceClick('food')">
                ðŸŒ¾ Food: 400
            </div>
            <div class="resource-item" onclick="handleResourceClick('population')">
                ðŸ‘¥ Population: 45/100
            </div>
        </div>

        <div class="main-map" id="main-map">
            <svg class="map-svg" id="map-svg" viewBox="0 0 800 600">
                <defs>
                    <!-- Gradients for 3D effect -->
                    <linearGradient id="terrainGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#3a5a3a"/>
                        <stop offset="50%" stop-color="#2a4a2a"/>
                        <stop offset="100%" stop-color="#1a3a1a"/>
                    </linearGradient>
                    <radialGradient id="waterGradient" cx="50%" cy="30%" r="70%">
                        <stop offset="0%" stop-color="#004488"/>
                        <stop offset="50%" stop-color="#003366"/>
                        <stop offset="100%" stop-color="#002244"/>
                    </radialGradient>
                    <linearGradient id="mountainGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#6a6a6a"/>
                        <stop offset="50%" stop-color="#4a4a4a"/>
                        <stop offset="100%" stop-color="#333"/>
                    </linearGradient>
                    <linearGradient id="buildingGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#aa8a5a"/>
                        <stop offset="50%" stop-color="#8a6a3a"/>
                        <stop offset="100%" stop-color="#6a4a2a"/>
                    </linearGradient>
                    <radialGradient id="unitGradient" cx="30%" cy="30%" r="70%">
                        <stop offset="0%" stop-color="#ffff88"/>
                        <stop offset="50%" stop-color="#ffff00"/>
                        <stop offset="100%" stop-color="#cccc00"/>
                    </radialGradient>
                    <radialGradient id="resourceGradient" cx="30%" cy="30%" r="70%">
                        <stop offset="0%" stop-color="#0088ff"/>
                        <stop offset="50%" stop-color="#0066ff"/>
                        <stop offset="100%" stop-color="#0044cc"/>
                    </radialGradient>
                </defs>
                <g id="map-content">
                    <!-- Terrain (isometric base) -->
                    <rect class="terrain" x="0" y="0" width="2400" height="1800"/>
                    
                    <!-- Water bodies with isometric perspective -->
                    <ellipse class="water" cx="200" cy="150" rx="80" ry="40"/>
                    <ellipse class="water" cx="600" cy="400" rx="100" ry="60"/>
                    <ellipse class="water" cx="1400" cy="800" rx="120" ry="70"/>
                    <ellipse class="water" cx="2000" cy="300" rx="90" ry="50"/>
                    <ellipse class="water" cx="1800" cy="1400" rx="150" ry="80"/>
                    
                    <!-- Mountains as isometric blocks -->
                    <g class="mountain" transform="translate(100,100)">
                        <polygon points="0,40 25,15 75,15 50,40 25,65 -25,65"/>
                        <polygon points="25,15 75,15 75,-10 25,-10" fill="#5a5a5a"/>
                        <polygon points="75,15 50,40 50,15 75,-10" fill="#3a3a3a"/>
                    </g>
                    <g class="mountain" transform="translate(650,200)">
                        <polygon points="0,40 25,15 75,15 50,40 25,65 -25,65"/>
                        <polygon points="25,15 75,15 75,-10 25,-10" fill="#5a5a5a"/>
                        <polygon points="75,15 50,40 50,15 75,-10" fill="#3a3a3a"/>
                    </g>
                    <g class="mountain" transform="translate(50,450)">
                        <polygon points="0,40 25,15 75,15 50,40 25,65 -25,65"/>
                        <polygon points="25,15 75,15 75,-10 25,-10" fill="#5a5a5a"/>
                        <polygon points="75,15 50,40 50,15 75,-10" fill="#3a3a3a"/>
                    </g>
                    <g class="mountain" transform="translate(1200,600)">
                        <polygon points="0,40 25,15 75,15 50,40 25,65 -25,65"/>
                        <polygon points="25,15 75,15 75,-10 25,-10" fill="#5a5a5a"/>
                        <polygon points="75,15 50,40 50,15 75,-10" fill="#3a3a3a"/>
                    </g>
                    <g class="mountain" transform="translate(1600,1000)">
                        <polygon points="0,40 25,15 75,15 50,40 25,65 -25,65"/>
                        <polygon points="25,15 75,15 75,-10 25,-10" fill="#5a5a5a"/>
                        <polygon points="75,15 50,40 50,15 75,-10" fill="#3a3a3a"/>
                    </g>
                    <g class="mountain" transform="translate(2200,1500)">
                        <polygon points="0,40 25,15 75,15 50,40 25,65 -25,65"/>
                        <polygon points="25,15 75,15 75,-10 25,-10" fill="#5a5a5a"/>
                        <polygon points="75,15 50,40 50,15 75,-10" fill="#3a3a3a"/>
                    </g>
                    <g class="mountain" transform="translate(900,1300)">
                        <polygon points="0,40 25,15 75,15 50,40 25,65 -25,65"/>
                        <polygon points="25,15 75,15 75,-10 25,-10" fill="#5a5a5a"/>
                        <polygon points="75,15 50,40 50,15 75,-10" fill="#3a3a3a"/>
                    </g>
                    
                    <!-- Resource nodes as isometric crystals -->
                    <g transform="translate(300,200)">
                        <polygon class="resource-node" points="0,6 4,2 8,6 4,10" transform="rotate(-45)"/>
                        <polygon points="4,2 8,6 8,2 4,-2" fill="#0088ff"/>
                        <polygon points="8,6 4,10 4,6 8,2" fill="#0044cc"/>
                    </g>
                    <g transform="translate(500,300)">
                        <polygon class="resource-node" points="0,6 4,2 8,6 4,10" transform="rotate(-45)"/>
                        <polygon points="4,2 8,6 8,2 4,-2" fill="#0088ff"/>
                        <polygon points="8,6 4,10 4,6 8,2" fill="#0044cc"/>
                    </g>
                    <g transform="translate(400,500)">
                        <polygon class="resource-node" points="0,6 4,2 8,6 4,10" transform="rotate(-45)"/>
                        <polygon points="4,2 8,6 8,2 4,-2" fill="#0088ff"/>
                        <polygon points="8,6 4,10 4,6 8,2" fill="#0044cc"/>
                    </g>
                    <g transform="translate(1100,400)">
                        <polygon class="resource-node" points="0,6 4,2 8,6 4,10" transform="rotate(-45)"/>
                        <polygon points="4,2 8,6 8,2 4,-2" fill="#0088ff"/>
                        <polygon points="8,6 4,10 4,6 8,2" fill="#0044cc"/>
                    </g>
                    <g transform="translate(1500,700)">
                        <polygon class="resource-node" points="0,6 4,2 8,6 4,10" transform="rotate(-45)"/>
                        <polygon points="4,2 8,6 8,2 4,-2" fill="#0088ff"/>
                        <polygon points="8,6 4,10 4,6 8,2" fill="#0044cc"/>
                    </g>
                    <g transform="translate(1800,1100)">
                        <polygon class="resource-node" points="0,6 4,2 8,6 4,10" transform="rotate(-45)"/>
                        <polygon points="4,2 8,6 8,2 4,-2" fill="#0088ff"/>
                        <polygon points="8,6 4,10 4,6 8,2" fill="#0044cc"/>
                    </g>
                    <g transform="translate(2100,900)">
                        <polygon class="resource-node" points="0,6 4,2 8,6 4,10" transform="rotate(-45)"/>
                        <polygon points="4,2 8,6 8,2 4,-2" fill="#0088ff"/>
                        <polygon points="8,6 4,10 4,6 8,2" fill="#0044cc"/>
                    </g>
                    <g transform="translate(700,1200)">
                        <polygon class="resource-node" points="0,6 4,2 8,6 4,10" transform="rotate(-45)"/>
                        <polygon points="4,2 8,6 8,2 4,-2" fill="#0088ff"/>
                        <polygon points="8,6 4,10 4,6 8,2" fill="#0044cc"/>
                    </g>
                    <g transform="translate(1300,1500)">
                        <polygon class="resource-node" points="0,6 4,2 8,6 4,10" transform="rotate(-45)"/>
                        <polygon points="4,2 8,6 8,2 4,-2" fill="#0088ff"/>
                        <polygon points="8,6 4,10 4,6 8,2" fill="#0044cc"/>
                    </g>
                    
                    <!-- Buildings as isometric structures -->
                    <g transform="translate(1150,1050)">
                        <polygon class="building" points="0,30 15,15 45,15 30,30 15,45 -15,45"/>
                        <polygon points="15,15 45,15 45,-5 15,-5" fill="#aa8a5a"/>
                        <polygon points="45,15 30,30 30,10 45,-5" fill="#6a4a2a"/>
                    </g>
                    <g transform="translate(1200,1000)">
                        <polygon class="building" points="0,25 12.5,12.5 37.5,12.5 25,25 12.5,37.5 -12.5,37.5"/>
                        <polygon points="12.5,12.5 37.5,12.5 37.5,-2.5 12.5,-2.5" fill="#aa8a5a"/>
                        <polygon points="37.5,12.5 25,25 25,10 37.5,-2.5" fill="#6a4a2a"/>
                    </g>
                    <g transform="translate(1600,600)">
                        <polygon class="building" points="0,35 17.5,17.5 52.5,17.5 35,35 17.5,52.5 -17.5,52.5"/>
                        <polygon points="17.5,17.5 52.5,17.5 52.5,-7.5 17.5,-7.5" fill="#aa8a5a"/>
                        <polygon points="52.5,17.5 35,35 35,10 52.5,-7.5" fill="#6a4a2a"/>
                    </g>
                    <g transform="translate(2000,1200)">
                        <polygon class="building" points="0,30 15,15 45,15 30,30 15,45 -15,45"/>
                        <polygon points="15,15 45,15 45,-5 15,-5" fill="#aa8a5a"/>
                        <polygon points="45,15 30,30 30,10 45,-5" fill="#6a4a2a"/>
                    </g>
                    <g transform="translate(800,800)">
                        <polygon class="building" points="0,40 20,20 60,20 40,40 20,60 -20,60"/>
                        <polygon points="20,20 60,20 60,-10 20,-10" fill="#aa8a5a"/>
                        <polygon points="60,20 40,40 40,10 60,-10" fill="#6a4a2a"/>
                    </g>
                    
                    <!-- Units as isometric figures -->
                    <g transform="translate(1120,1080)">
                        <ellipse class="unit" cx="0" cy="0" rx="8" ry="4" transform="rotate(-45)"/>
                        <ellipse cx="-1" cy="-2" rx="6" ry="3" fill="#ffff88" transform="rotate(-45)"/>
                    </g>
                    <g transform="translate(1180,1120)">
                        <ellipse class="unit" cx="0" cy="0" rx="8" ry="4" transform="rotate(-45)"/>
                        <ellipse cx="-1" cy="-2" rx="6" ry="3" fill="#ffff88" transform="rotate(-45)"/>
                    </g>
                    <g transform="translate(1250,1050)">
                        <ellipse class="unit" cx="0" cy="0" rx="8" ry="4" transform="rotate(-45)"/>
                        <ellipse cx="-1" cy="-2" rx="6" ry="3" fill="#ffff88" transform="rotate(-45)"/>
                    </g>
                    <g transform="translate(1220,1080)">
                        <ellipse class="unit" cx="0" cy="0" rx="8" ry="4" transform="rotate(-45)"/>
                        <ellipse cx="-1" cy="-2" rx="6" ry="3" fill="#ffff88" transform="rotate(-45)"/>
                    </g>
                    <g transform="translate(820,850)">
                        <ellipse class="unit" cx="0" cy="0" rx="8" ry="4" transform="rotate(-45)"/>
                        <ellipse cx="-1" cy="-2" rx="6" ry="3" fill="#ffff88" transform="rotate(-45)"/>
                    </g>
                    <g transform="translate(850,820)">
                        <ellipse class="unit" cx="0" cy="0" rx="8" ry="4" transform="rotate(-45)"/>
                        <ellipse cx="-1" cy="-2" rx="6" ry="3" fill="#ffff88" transform="rotate(-45)"/>
                    </g>
                    <g transform="translate(1650,650)">
                        <ellipse class="unit" cx="0" cy="0" rx="8" ry="4" transform="rotate(-45)"/>
                        <ellipse cx="-1" cy="-2" rx="6" ry="3" fill="#ffff88" transform="rotate(-45)"/>
                    </g>
                    <g transform="translate(2050,1250)">
                        <ellipse class="unit" cx="0" cy="0" rx="8" ry="4" transform="rotate(-45)"/>
                        <ellipse cx="-1" cy="-2" rx="6" ry="3" fill="#ffff88" transform="rotate(-45)"/>
                    </g>
                </g>
            </svg>
        </div>

        <div class="minimap">
            <div class="menu-title">MINIMAP</div>
            <svg class="minimap-svg" viewBox="0 0 200 150">
                <!-- Simplified terrain -->
                <rect class="terrain" x="0" y="0" width="200" height="150"/>
                
                <!-- Water (scaled down from main map) -->
                <ellipse class="water" cx="17" cy="12" rx="7" ry="3"/>
                <ellipse class="water" cx="50" cy="33" rx="8" ry="5"/>
                <ellipse class="water" cx="117" cy="67" rx="10" ry="6"/>
                <ellipse class="water" cx="167" cy="25" rx="7" ry="4"/>
                <ellipse class="water" cx="150" cy="117" rx="12" ry="7"/>
                
                <!-- Mountains (scaled down from main map) -->
                <polygon class="mountain" points="8,8 12,4 17,8 15,12 10,12"/>
                <polygon class="mountain" points="54,17 58,12 62,17 60,21 56,21"/>
                <polygon class="mountain" points="4,37 8,33 12,37 10,42 6,42"/>
                <polygon class="mountain" points="100,50 104,46 108,50 106,54 102,54"/>
                <polygon class="mountain" points="133,83 137,79 142,83 140,87 135,87"/>
                <polygon class="mountain" points="183,125 187,121 192,125 190,129 185,129"/>
                <polygon class="mountain" points="75,108 79,104 83,108 81,112 77,112"/>
                
                <!-- Buildings (scaled down from main map) -->
                <rect class="building" x="96" y="87" width="3" height="3"/>
                <rect class="building" x="100" y="83" width="2" height="2"/>
                <rect class="building" x="133" y="50" width="3" height="3"/>
                <rect class="building" x="167" y="100" width="3" height="3"/>
                <rect class="building" x="67" y="67" width="3" height="3"/>
                
                <!-- Units (scaled down from main map) -->
                <circle class="unit" cx="93" cy="90" r="1"/>
                <circle class="unit" cx="98" cy="93" r="1"/>
                <circle class="unit" cx="104" cy="87" r="1"/>
                <circle class="unit" cx="102" cy="90" r="1"/>
                <circle class="unit" cx="68" cy="71" r="1"/>
                <circle class="unit" cx="71" cy="68" r="1"/>
                <circle class="unit" cx="137" cy="54" r="1"/>
                <circle class="unit" cx="171" cy="104" r="1"/>
                
                <!-- View rectangle -->
                <rect id="viewport-rect" x="66" y="50" width="67" height="50" fill="none" stroke="#ffff00" stroke-width="2" opacity="0.8"/>
            </svg>
        </div>

        <div class="build-menu">
            <div class="menu-title">BUILD MENU</div>
            <button class="menu-button" onclick="handleBuildButton('barracks')">Barracks</button>
            <button class="menu-button" onclick="handleBuildButton('house')">House</button>
            <button class="menu-button" onclick="handleBuildButton('farm')">Farm</button>
            <button class="menu-button" onclick="handleBuildButton('mine')">Mine</button>
            <button class="menu-button" onclick="handleBuildButton('tower')">Tower</button>
            <button class="menu-button" onclick="handleBuildButton('wall')">Wall</button>
            <button class="menu-button" onclick="handleBuildButton('gate')">Gate</button>
            <button class="menu-button" onclick="handleBuildButton('workshop')">Workshop</button>
        </div>

        <div class="research-menu">
            <div class="menu-title">RESEARCH</div>
            <button class="menu-button" onclick="handleResearchButton('armor')">Armor Tech</button>
            <button class="menu-button" onclick="handleResearchButton('weapons')">Weapon Tech</button>
            <button class="menu-button" onclick="handleResearchButton('agriculture')">Agriculture</button>
            <button class="menu-button" onclick="handleResearchButton('mining')">Mining Tech</button>
            <button class="menu-button" onclick="handleResearchButton('construction')">Construction</button>
            <button class="menu-button" onclick="handleResearchButton('magic')">Magic Arts</button>
            <button class="menu-button" onclick="handleResearchButton('tactics')">Tactics</button>
        </div>

        <div class="controls">
            <div class="menu-title">UNIT CONTROLS</div>
            <button class="control-button" onclick="handleUnitCommand('move')">MOVE</button>
            <button class="control-button" onclick="handleUnitCommand('attack')">ATTACK</button>
            <button class="control-button" onclick="handleUnitCommand('patrol')">PATROL</button>
            <button class="control-button" onclick="handleUnitCommand('stop')">STOP</button>
        </div>
    </div>

    <div class="status-display" id="status">
        RTS Game UI Mockup - Click on any element to see status messages
    </div>

    <div class="footer">
        <span>Copyright &copy; 2025 Michael A. Wright</span>
        <span class="footer-separator">|</span>
        <a href="LICENSE" target="_blank">MIT License</a>
        <span class="footer-separator">|</span>
        <a href="https://github.com/softwarewrighter/rts_mock" target="_blank">GitHub Repository</a>
    </div>

    <script type="module">
        import init, { 
            handle_map_click, 
            handle_minimap_click, 
            handle_build_button, 
            handle_research_button, 
            handle_unit_command,
            handle_resource_click,
            log_status 
        } from './pkg/rts_mock.js';

        // Map state management in JavaScript
        const mapState = {
            mapWidth: 2400,
            mapHeight: 1800,
            viewportWidth: 800,
            viewportHeight: 600,
            viewportX: 800, // Start centered
            viewportY: 600
        };

        let isDragging = false;
        let dragStart = { x: 0, y: 0 };
        let viewportStart = { x: 0, y: 0 };
        let scrollInterval = null;
        let currentMousePos = { x: 0, y: 0 };

        function updateMapView() {
            const mapContent = document.getElementById('map-content');
            if (mapContent) {
                // Apply viewport translation first, then gentler isometric transformation
                const viewportTransform = `translate(${-mapState.viewportX}, ${-mapState.viewportY})`;
                // Reduced rotation for better minimap alignment: less skew, more similar to top-down
                const isoTransform = 'matrix(1, 0.15, -0.3, 0.9, 200, 50)';
                mapContent.setAttribute('transform', `${isoTransform} ${viewportTransform}`);
            }
            updateMinimapViewport();
        }

        function updateMinimapViewport() {
            const viewportRect = document.getElementById('viewport-rect');
            if (viewportRect) {
                const scaleX = 200 / mapState.mapWidth;
                const scaleY = 150 / mapState.mapHeight;
                
                viewportRect.setAttribute('x', mapState.viewportX * scaleX);
                viewportRect.setAttribute('y', mapState.viewportY * scaleY);
                viewportRect.setAttribute('width', mapState.viewportWidth * scaleX);
                viewportRect.setAttribute('height', mapState.viewportHeight * scaleY);
            }
        }

        function clampViewport() {
            mapState.viewportX = Math.max(0, Math.min(mapState.viewportX, mapState.mapWidth - mapState.viewportWidth));
            mapState.viewportY = Math.max(0, Math.min(mapState.viewportY, mapState.mapHeight - mapState.viewportHeight));
        }

        function handleEdgeScroll() {
            const mapDiv = document.getElementById('main-map');
            const rect = mapDiv.getBoundingClientRect();
            const edgeThreshold = 50;
            const scrollSpeed = 20;
            
            let dx = 0;
            let dy = 0;
            
            if (currentMousePos.x < edgeThreshold) dx = -scrollSpeed;
            else if (currentMousePos.x > rect.width - edgeThreshold) dx = scrollSpeed;
            
            if (currentMousePos.y < edgeThreshold) dy = -scrollSpeed;
            else if (currentMousePos.y > rect.height - edgeThreshold) dy = scrollSpeed;
            
            if (dx !== 0 || dy !== 0) {
                mapState.viewportX += dx;
                mapState.viewportY += dy;
                clampViewport();
                updateMapView();
            }
        }

        async function run() {
            await init();
            
            // Override console.log to show status in UI
            const originalLog = console.log;
            console.log = function(message) {
                originalLog(message);
                const statusEl = document.getElementById('status');
                if (statusEl && typeof message === 'string' && message.includes('RTS Status:')) {
                    statusEl.textContent = message.replace('RTS Status: ', '');
                }
            };

            // Initialize map view
            updateMapView();
            log_status("Game UI initialized with scrollable map");

            // Map interactions
            const mapSvg = document.getElementById('map-svg');
            const mapDiv = document.getElementById('main-map');
            
            // Map click handler with isometric coordinate conversion
            mapSvg.addEventListener('click', function(event) {
                if (!isDragging) {
                    const rect = mapSvg.getBoundingClientRect();
                    const screenX = event.clientX - rect.left;
                    const screenY = event.clientY - rect.top;
                    
                    // Convert screen coordinates to SVG coordinates
                    const svgX = (screenX / rect.width) * 800;
                    const svgY = (screenY / rect.height) * 600;
                    
                    // Reverse the isometric transformation matrix
                    // matrix(0.866, 0.5, -0.866, 0.5, 400, 100)
                    const adjustedX = svgX - 400;
                    const adjustedY = svgY - 100;
                    
                    // Apply inverse matrix transformation
                    const det = 0.866 * 0.5 - 0.5 * (-0.866); // determinant
                    const worldX = ((0.5 * adjustedX) - (-0.866 * adjustedY)) / det + mapState.viewportX;
                    const worldY = ((-0.5 * adjustedX) + (0.866 * adjustedY)) / det + mapState.viewportY;
                    
                    handle_map_click(worldX, worldY);
                }
            });

            // Mouse down for drag
            mapDiv.addEventListener('mousedown', function(event) {
                if (event.button === 0) { // Left mouse button
                    isDragging = true;
                    dragStart.x = event.clientX;
                    dragStart.y = event.clientY;
                    viewportStart.x = mapState.viewportX;
                    viewportStart.y = mapState.viewportY;
                    mapDiv.classList.add('dragging');
                    event.preventDefault();
                }
            });

            // Mouse move for drag and edge scroll with isometric adjustments
            document.addEventListener('mousemove', function(event) {
                const rect = mapDiv.getBoundingClientRect();
                const isOverMap = event.clientX >= rect.left && event.clientX <= rect.right &&
                                 event.clientY >= rect.top && event.clientY <= rect.bottom;
                
                if (isOverMap) {
                    currentMousePos.x = event.clientX - rect.left;
                    currentMousePos.y = event.clientY - rect.top;
                    
                    if (isDragging && event.buttons === 1) {
                        // Direct 1:1 movement without scaling compensation
                        const screenDx = dragStart.x - event.clientX;
                        const screenDy = dragStart.y - event.clientY;
                        
                        mapState.viewportX = viewportStart.x + screenDx;
                        mapState.viewportY = viewportStart.y + screenDy;
                        clampViewport();
                        updateMapView();
                    } else if (!isDragging && !scrollInterval) {
                        scrollInterval = setInterval(handleEdgeScroll, 16);
                    }
                } else if (scrollInterval) {
                    clearInterval(scrollInterval);
                    scrollInterval = null;
                }
            });

            // Mouse up to stop drag
            document.addEventListener('mouseup', function(event) {
                if (event.button === 0) {
                    isDragging = false;
                    mapDiv.classList.remove('dragging');
                }
            });

            // Minimap click handler
            const minimapSvg = document.querySelector('.minimap-svg');
            minimapSvg.addEventListener('click', function(event) {
                const pt = minimapSvg.createSVGPoint();
                pt.x = event.clientX;
                pt.y = event.clientY;
                const svgP = pt.matrixTransform(minimapSvg.getScreenCTM().inverse());
                
                // Convert minimap coordinates to world coordinates
                const scaleX = mapState.mapWidth / 200;
                const scaleY = mapState.mapHeight / 150;
                
                // Center viewport on clicked position
                mapState.viewportX = (svgP.x * scaleX) - (mapState.viewportWidth / 2);
                mapState.viewportY = (svgP.y * scaleY) - (mapState.viewportHeight / 2);
                clampViewport();
                updateMapView();
                
                handle_minimap_click(svgP.x, svgP.y);
            });

            // Keyboard controls with isometric adjustments
            document.addEventListener('keydown', function(event) {
                const step = 40;
                let moved = false;
                
                switch(event.key) {
                    case 'ArrowUp':
                    case 'w':
                    case 'W':
                        mapState.viewportY -= step;
                        moved = true;
                        break;
                    case 'ArrowDown':
                    case 's':
                    case 'S':
                        mapState.viewportY += step;
                        moved = true;
                        break;
                    case 'ArrowLeft':
                    case 'a':
                    case 'A':
                        mapState.viewportX -= step;
                        moved = true;
                        break;
                    case 'ArrowRight':
                    case 'd':
                    case 'D':
                        mapState.viewportX += step;
                        moved = true;
                        break;
                }
                
                if (moved) {
                    event.preventDefault();
                    clampViewport();
                    updateMapView();
                    log_status(`Viewport moved to (${Math.round(mapState.viewportX)}, ${Math.round(mapState.viewportY)})`);
                }
            });

            // Make WASM functions globally available
            window.handleBuildButton = handle_build_button;
            window.handleResearchButton = handle_research_button;
            window.handleUnitCommand = handle_unit_command;
            window.handleResourceClick = handle_resource_click;
        }

        run();
    </script>
</body>
</html>